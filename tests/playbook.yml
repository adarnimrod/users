---
- hosts: ansible-role-users-openbsd
  gather_facts: False
  roles:
      - ansible-role-openbsd-bootstrap

- hosts: all
  vars:
      users:
          - name: root
            password: '*'
            email: none@nowhere.com
          - name: dummy
            groups:
                - people
                - sudoers
            pubkeys:
                - '{{ lookup("file", "id_rsa.pub") }}'
          - name: person
            password: '{{ "$2b$08$tQ5R9gYozyT4axTcKuBieeeVbgCXzZkDuTP4CL7HhQ9kvXRztxsCW" if ansible_os_family == "OpenBSD" else "$6$VWrYt43IIuVoA.G$I3UacUhyEz58NAJgelWJr0EfTmqNGxOqatfYxBH0wzCIZLcsjZ1V0/AAibzTu6KjdsUFSC3Mmjjr0cWHcV8401" }}'
            groups:
                - people
  roles:
    - role: ansible-role-users
  post_tasks: # For testing purposes
      - name: Create .ssh directory
        file:
            path: '{{ ansible_user_dir }}/.ssh'
            state: directory

      - name: Copy private key
        copy:
            src: id_rsa
            dest: '{{ ansible_user_dir }}/.ssh/id_rsa'
            mode: 0o0400

      - name: Add localhost key to known hosts
        changed_when: False
        shell: 'ssh-keyscan localhost >> ~/.ssh/known_hosts'
